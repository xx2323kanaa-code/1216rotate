<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Right Hand – Phone Hold Demo</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
html,body{
  margin:0;
  padding:0;
  width:100%;
  height:100%;
  background:black;
}
body{
  display:flex;
  justify-content:center;
  align-items:center;
}

svg{
  width:100vw;
  max-width:420px;
  height:auto;
}

.hand-mass{
  fill:rgba(255,255,0,0.25);
  stroke:none;
}

.finger,.thumb{
  stroke:yellow;
  stroke-width:5;
  stroke-linecap:round;
}

.nail{
  fill:yellow;
}

.phone{
  fill:#1e6cff;
  rx:14;
  ry:14;
  opacity:0;
}

.label{
  fill:#aaa;
  font-size:14px;
  text-anchor:middle;
}
</style>
</head>

<body>

<svg viewBox="0 0 360 360">

  <!-- ケータイ（世界座標・回らない） -->
  <rect id="phone" class="phone"
        x="150" y="135" width="60" height="110"/>

  <!-- 手 -->
  <g id="handRoot">

    <!-- 手首＋手の甲（一体） -->
    <g id="handMass">
      <rect x="140" y="235" width="80" height="55"
            rx="22" class="hand-mass"/>
      <rect x="140" y="185" width="80" height="80"
            rx="24" class="hand-mass"/>
    </g>

    <!-- 指 -->
    <g id="fingersGroup">
      <line id="thumb"  class="thumb"/>
      <line id="index"  class="finger"/>
      <line id="middle" class="finger"/>
      <line id="ring"   class="finger"/>
      <line id="little" class="finger"/>

      <polygon id="n_thumb"  class="nail"/>
      <polygon id="n_index"  class="nail"/>
      <polygon id="n_middle" class="nail"/>
      <polygon id="n_ring"   class="nail"/>
      <polygon id="n_little" class="nail"/>
    </g>
  </g>

  <text id="label" x="180" y="35" class="label">RELAX</text>
</svg>

<script>
const baseY = 185;

const fingers = {
  thumb:  { x:230, relax:40, hold:28, lock:22 },
  index:  { x:210, relax:75, hold:36, lock:26 },
  middle: { x:190, relax:72, hold:38, lock:32 },
  ring:   { x:170, relax:68, hold:32, lock:28 },
  little: { x:150, relax:60, hold:30, lock:26 }
};

const pivotBase = { x:180, y:255 };
const pivotByState = {
  RELAX:{x:0,y:0},
  HOLD:{x:1,y:-1},
  LOCK:{x:2,y:-2}
};

const rotationByState = {
  RELAX:{mass:0,fingers:0},
  HOLD:{mass:6,fingers:14},
  LOCK:{mass:8,fingers:18}
};

const handMass = document.getElementById("handMass");
const fingersGroup = document.getElementById("fingersGroup");
const phone = document.getElementById("phone");
const label = document.getElementById("label");

function nail(id,x,y){
  const s=6;
  document.getElementById(id)
    .setAttribute("points",`${x-s},${y} ${x+s},${y} ${x},${y-s}`);
}

function applyState(state){
  label.textContent = state;

  phone.style.opacity = state==="RELAX" ? 0 : 1;

  const pivot = {
    x: pivotBase.x + pivotByState[state].x,
    y: pivotBase.y + pivotByState[state].y
  };

  handMass.setAttribute(
    "transform",
    `rotate(${rotationByState[state].mass} ${pivot.x} ${pivot.y})`
  );
  fingersGroup.setAttribute(
    "transform",
    `rotate(${rotationByState[state].fingers} ${pivot.x} ${pivot.y})`
  );

  for(const id in fingers){
    const f=fingers[id];
    const el=document.getElementById(id);
    const len =
      state==="RELAX"?f.relax:
      state==="HOLD"?f.hold:
      f.lock;

    el.setAttribute("x1",f.x);
    el.setAttribute("y1",baseY);
    el.setAttribute("x2",f.x);
    el.setAttribute("y2",baseY-len);

    const n=document.getElementById("n_"+id);
    if(state==="RELAX"){
      nail("n_"+id,f.x,baseY-len);
      n.style.opacity=1;
    }else{
      n.style.opacity=0;
    }
  }

  // 親指は内側へ倒す
  const th=document.getElementById("thumb");
  if(state==="RELAX"){
    th.setAttribute("x2",260);
    th.setAttribute("y2",205);
  }else{
    th.setAttribute("x2",210);
    th.setAttribute("y2",215);
  }
}

function applyLockWithLead(){
  applyState("HOLD");
  setTimeout(()=>{
    applyState("LOCK");
  },200);
}

const sequence = ["RELAX","HOLD","LOCK","HOLD","RELAX"];
let idx=0;

setInterval(()=>{
  const s=sequence[idx];
  if(s==="LOCK"){
    applyLockWithLead();
  }else{
    applyState(s);
  }
  idx=(idx+1)%sequence.length;
},2600);

applyState("RELAX");
</script>

</body>
</html>
